<?xml version="1.0" encoding="UTF-8"?>
<database name="ajwm" defaultIdMethod="native">

  <table name="user" phpName="User">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="username" type="varchar" size="64" required="true" primaryString="true" />
    <column name="password" type="varchar" size="36" required="true" />
    <column name="privilege" type="tinyint" required="true" />
    <column name="name" type="varchar" size="128" required="true"/>
    <column name="email" type="varchar" size="255" required="true"/>
    <column name="company_name" type="varchar" size="128" required="false"/>
    <column name="cellphone" type="varchar" size="64" required="true"/>
    <column name="active" type="tinyint" size="1" required="true" default="1" />
    <column name="last_session" type="varchar" size="64" required="false" />
    <column name="last_ip" type="varchar" size="15" required="false" />
    <column name="deleted_on" type="TIMESTAMP" />
    <column name="last_activity_on" type="TIMESTAMP" />
    <column name="saved_session" type="longvarchar" />
    <column name="saved_settings" type="longvarchar" />
    <column name="timezone" type="varchar" size="255" required="false" />

    <validator column="username">
      <rule name="unique" message="already exists" />
    </validator>
    <validator column="name">
      <rule name="minLength" value="4" message="MIN ${value}" />
      <rule name="maxLength" value="64" message="MAX ${value}" />
    </validator>
    <validator column="email">
      <rule name="match" value="/^([a-zA-Z0-9])+([\.a-zA-Z0-9_-])*@([a-zA-Z0-9])+(\.[a-zA-Z0-9_-]+)+$/" message="Please enter a valid email address." />
    </validator>
    <validator column="cellphone">
      <rule name="minLength" value="8" message="MIN ${value}" />
      <rule name="maxLength" value="64" message="MAX ${value}" />
    </validator>

    <behavior name="soft_delete">
      <parameter name="deleted_column" value="deleted_on" />
    </behavior>
  </table>

  <table name="timezone">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="name" type="varchar" size="255" required="true" primaryString="true" />
    <column name="format" type="varchar" size="255" required="false" />
  </table>

  <table name="location">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="ccode" type="varchar" size="255" required="true" />
    <column name="name" type="varchar" size="255" required="true" primaryString="true" />
    <column name="country" type="varchar" size="255" required="true" />
    <column name="url" type="varchar" size="255" required="true" />
  </table>

  <!-- APPLICATIONS -->

  <table name="app_email_mailbox">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="name" type="varchar" size="255" required="true" primaryString="true" />
    <column name="path" type="varchar" size="255" required="true" primaryString="true" />

    <column name="user_id" type="integer" />
    <foreign-key foreignTable="user" onDelete="cascade">
      <reference local="user_id" foreign="id"/>
    </foreign-key>
  </table>

  <table name="app_email_message">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="message_id" type="varchar" size="1024" required="true"  />
    <column name="mailbox_id" type="integer" required="true" />
    <column name="user_id" type="integer" />
    <column name="status" type="tinyint" size="1" default="0" required="true" />
    <column name="from" type="varchar" size="255" required="true" />
    <column name="date" type="varchar" size="255" required="true" />
    <column name="subject" type="varchar" size="255" primaryString="true" />
    <column name="message" type="longvarchar" />

    <foreign-key foreignTable="user" onDelete="cascade">
      <reference local="user_id" foreign="id"/>
    </foreign-key>
    <foreign-key foreignTable="app_email_mailbox" onDelete="cascade">
      <reference local="mailbox_id" foreign="id"/>
    </foreign-key>
  </table>

</database>
